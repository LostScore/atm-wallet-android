(window.webpackJsonp=window.webpackJsonp||[]).push([[56,60],{317:function(e,t,r){"use strict";r.r(t),r.d(t,"proxyTo",function(){return b});r(18);var n=r(165),a=r.n(n),s=r(4),i=r.n(s),u=(r(11),r(0)),c=r.n(u),o=r(1),p=r(12),l=r(25),f=r(35),h=r(10),m={computed:{slug:function(){return this.service.slug},type:function(){var e=this.params;return"function"==typeof this.service.typeFor?this.service.typeFor(e):""},subtitle:function(){var e,t=this.params;return"function"==typeof this.service.subtitleFor&&(e=this.service.subtitleFor(t)),e||this.type},title:function(){var e=this.params;return"function"==typeof this.service.titleFor?this.service.titleFor(e):this.$t("exchange.title.".concat(this.service.type))},limits:function(){var e=this.params;return"function"==typeof this.service.limitsStringFor?this.service.limitsStringFor(e):""}}};function b(e){return function(){var t=c()(regeneratorRuntime.mark(function t(r){var n,a,s,u,c,o,p,l,f,m,b,x=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(c in n=x.length>1&&void 0!==x[1]?x[1]:{},a={},s=e,u=!1,r)o=s.indexOf(":"+c),p=r[c],~o?s=s.substring(0,o)+p+s.substring(o+c.length+1):(a[c]=p,u=!0);return l={},t.next=8,Object(h.a)({method:u?"POST":"GET",url:"/_api".concat(s),body:u?a:void 0,headers:i()({},this.headers,l,n.headers)});case 8:if(f=t.sent,m=f.result,!(b=f.error)){t.next=15;break}throw new Error(b);case 15:if(!m){t.next=17;break}return t.abrupt("return",m);case 17:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}t.default={created:function(){var e=c()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._ready=!1,this._latch=new o.a,"function"!=typeof this.initialize){e.next=5;break}return e.next=5,this.initialize();case 5:"undefined"!=typeof window&&(window.services=window.services||{},window.services[this.slug]=this),this._ready=!0,this._latch.resolve(!0),this._latch={promise:function(){return Promise.resolve(!0)}};case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{ready:function(){return this._latch.promise()},enabled:function(){return!0},baseAmount:function(e,t){var r={};return r=Object(o.b)(e.currency,t)?e:p.a.convert(e,t),r.currency=t&&t.toUpperCase(),r},paymentMethodFor:function(){var e=c()(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,e.abrupt("return",new Vue({store:this.$store,i18n:this.$i18n,mixins:[m],data:function(){return{params:i()({},t),service:r}}}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),action:function(){var e=c()(regeneratorRuntime.mark(function e(t){var r,n,s,i,u,c,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t,i=null;case 2:if(!r){e.next=27;break}if(n=r,r=null,"rpc"!=n.type){e.next=22;break}if(u=n.method,!n.schema){e.next=13;break}return e.next=10,this.prepareExecutionHash(n.params,n.schema,i);case 10:e.t0=e.sent,e.next=14;break;case 13:e.t0=n.params;case 14:return c=e.t0,i=null,e.next=18,l.a.rpc(u,c);case 18:if(!(o=e.sent).error){e.next=21;break}return e.abrupt("return",n.fallback||{error:o.error});case 21:o.result&&(s=o.result,n.params.then&&(r=n.params.then),o.result.execute&&(r=o.result.execute),o.result.action&&(r=o.result.action),o.result.transaction&&o.result.transaction.id&&this.$store.dispatch("exchange/updateMeta",a()({},"services.".concat(this.slug,".lastTxId"),s.transaction.id)));case 22:if("screen"!=n.type){e.next=24;break}return e.abrupt("return",{result:n});case 24:"exit"==n.type&&Object(f.b)(),e.next=2;break;case 27:return e.abrupt("return",{result:s});case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),quote:function(){var e=c()(regeneratorRuntime.mark(function e(t){var r,n,a,s,i,u,c,o,h,m,b,x,d,k;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{});case 2:return r=t.amount,n=t.to,a=t.from,this.to=n&&n.toUpperCase(),s={mode:t.mode,amount:this.baseAmount(r,a),to:this.to,from:a&&a.toUpperCase(),serviceToken:this.token},e.next=7,Object(f.d)("eth");case 7:if((i=e.sent)&&!i.error&&(s.ethereumAddress=i),"buy"==t.mode){e.next=14;break}return e.next=12,Object(f.d)(a);case 12:(u=e.sent).error||(s.refundAddress=u);case 14:if("sell"==t.mode){e.next=19;break}return e.next=17,Object(f.d)(n);case 17:(c=e.sent).error||(s.address=c);case 19:return o=this.slug,h=this.$store.state.exchange.trade.pairMeta,"trade"==t.mode&&h&&h[0]&&h[0].maximum&&h[1]&&h[1].maximum&&(m=1===p.a.currencyCompare(h[0].maximum,h[1].maximum)?0:1,"changelly"!==o&&p.a.currencyCompare(s.amount,h[m].maximum)>0&&(o="changelly")),b=o?"".concat(o,"/quote"):"quote",e.next=25,l.a.rpc(b,s);case 25:if(x=e.sent,d=x.result,!(k=x.error)){e.next=30;break}return e.abrupt("return",{error:k});case 30:return e.abrupt("return",{result:d});case 31:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),execute:function(){var e=c()(regeneratorRuntime.mark(function e(t){var r,n,s,i,u,c,o,h,m,b,x,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.execute,n=r,u=null;case 3:if(!n){e.next=55;break}if(s=n,n=null,"rpc"!=s.type){e.next=20;break}return c=s.method,e.next=10,this.prepareExecutionHash(s.params,s.schema,u);case 10:return o=e.sent,u=null,e.next=14,l.a.rpc(c,o);case 14:if(!(h=e.sent).error){e.next=17;break}return e.abrupt("return",s.fallback||{error:h.error});case 17:h.result&&(i=h.result,h.result.execute&&(n=h.result.execute),h.result.action&&(n=h.result.action),h.result.transaction.id&&this.$store.dispatch("exchange/updateMeta",a()({},"services.".concat(this.slug,".lastTxId"),i.transaction.id))),e.next=53;break;case 20:if("blockchain-tx"!=s.type){e.next=45;break}return e.next=23,Object(f.g)({currency:s.currency.toLowerCase(),toAddress:s.address,toDescription:s.memo||"",amount:p.a.stringToCurrency(s.amount,s.currency),transmit:!0});case 23:if(m=e.sent,b=m.result,x=m.error,n=s.then,!x){e.next=37;break}if(d=x.response&&x.response.status,u=403==d?{status:"cancelled"}:{status:"error",error:x},n){e.next=34;break}return e.abrupt("return",this.transactionErrorScreen(x));case 34:n.fallback=this.transactionErrorScreen(x);case 35:e.next=43;break;case 37:if(u={status:"success",transactionHash:b.hash},n){e.next=42;break}return e.abrupt("return",this.genericSuccessScreen(b));case 42:n.fallback=this.genericSuccessScreen(b);case 43:e.next=53;break;case 45:if("browser-url"!=s.type){e.next=51;break}return e.next=48,Object(f.a)(s);case 48:n=s.then,e.next=53;break;case 51:if(!s.meta||!s.meta.screen){e.next=53;break}return e.abrupt("return",{result:s});case 53:e.next=3;break;case 55:return e.abrupt("return",{result:i});case 56:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),transactionErrorScreen:function(e){var t=e.response,r=t&&403==t.status?"cancelled":"error",n=e.message||e;return t&&401==t.status&&(n=this.$t("exchange.transaction.error.auth-error")),{result:{meta:{screen:{screenType:"error",title:this.$t("exchange.trade.".concat(r,".title")),message:this.$t("exchange.transaction.error.".concat(n)),userActions:[{type:"quote",params:null,title:this.$t("general.button.ok")}]}}}}},genericSuccessScreen:function(){return{result:{meta:{screen:{screenType:"complete",title:this.$t("exchange.general.completed.title"),message:this.$t("exchange.trade.completed.message"),userActions:[{type:"close",title:this.$t("general.button.ok")}]}}}}},prepareExecutionHash:function(){var e=c()(regeneratorRuntime.mark(function e(t,r,n){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){var e=c()(regeneratorRuntime.mark(function e(t,r,s){var u,c,o,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=r.type){e.next=17;break}if(!r.blockchainRef){e.next=8;break}return console.log("Blockchain ref for ",s),e.next=5,Object(f.d)(r.blockchainRef);case 5:return e.abrupt("return",e.sent);case 8:if(!r.srn){e.next=12;break}return e.abrupt("return",r.srn);case 12:if(!r.substitute){e.next=16;break}return e.abrupt("return",n[r.substitute]);case 16:return e.abrupt("return",t);case 17:u=i()({},t),e.t0=regeneratorRuntime.keys(r.properties);case 19:if((e.t1=e.t0()).done){e.next=36;break}if(c=e.t1.value,o=r.properties[c],p=t[c],r){e.next=27;break}u[c]=p,e.next=34;break;case 27:if(!o){e.next=33;break}return e.next=30,a(p,o,c);case 30:u[c]=e.sent,e.next=34;break;case 33:u[c]=p;case 34:e.next=19;break;case 36:return e.abrupt("return",u);case 37:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}(),e.next=3,a(t,r,null);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()}}},321:function(e,t,r){"use strict";r.r(t);var n=r(4),a=r.n(n),s=(r(113),r(11),r(0)),i=r.n(s),u=r(25),c=r(317),o=r(35),p=(r(12),r(1));t.default={mixins:[c.default],data:function(){return{token:null,type:"widget",kycState:null,configurationSteps:[{name:"Register",endpoint:"register",flow:"CoinifyRegister",setupOnly:!0}],estimatedDelivery:"4-6 days",slug:"coinify"}},computed:{readyToUse:function(){return!!this.token}},watch:{token:function(){this.token&&this.$kv.set("coinifyServiceToken",this.token)}},methods:{initialize:function(){var e=i()(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$kv.get("coinifyServiceToken");case 2:this.token=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),fetchKYCState:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.rpc("coinify/kyc",{serviceToken:this.token});case 2:if(t=e.sent,r=t.result,!(n=t.error)){e.next=8;break}return console.error("Error getting Coinify KYC state: ",n),e.abrupt("return",{error:n});case 8:return this.kycState=r,"error"!==(a=r.state)&&this.$store.dispatch("exchange/updateMeta",{"services.coinify.kyc.state":a}),e.abrupt("return",{result:r});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),fetchDetailLink:function(){var e=i()(regeneratorRuntime.mark(function e(t){var r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.rpc("coinify/trade_details",{serviceToken:this.token,tradeId:t});case 2:if(r=e.sent,n=r.result,!(a=r.error)){e.next=8;break}return console.error("Error getting trade_details: ",a),e.abrupt("return",{error:a});case 8:return e.abrupt("return",{result:n});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),nextStep:function(){if(!this.token)return 0},limits:function(){return null},titleFor:function(e){var t=e&&e.medium;return this.$t("exchange.coinify.title.".concat(t))},typeFor:function(e){var t=e.medium;return this.$t("exchange.coinify.type.".concat(t))},limitsStringFor:function(e){var t=e&&e.medium;return this.$t("exchange.coinify.limits.".concat(t))},history:function(){var e=i()(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.rpc("coinify/history",{serviceToken:this.token});case 2:if(t=e.sent,r=t.error,n=t.result,!r){e.next=7;break}throw r;case 7:if(n){e.next=9;break}throw new Error("coinify/history:no-result");case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),quote:function(){var e=i()(regeneratorRuntime.mark(function e(t){var r,n,a,s,i,c,p,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{});case 2:return r=t.amount,n=t.to,a=t.from,e.t0=this.baseAmount(r,a),e.t1=t.medium,e.t2=n&&n.toUpperCase(),e.t3=a&&a.toUpperCase(),e.t4=this.token,e.next=10,Object(o.d)(n);case 10:return e.t5=e.sent,s={amount:e.t0,medium:e.t1,to:e.t2,from:e.t3,serviceToken:e.t4,address:e.t5},e.next=14,u.a.rpc("coinify/quote",s);case 14:if(i=e.sent,c=i.result,!(p=i.error)){e.next=19;break}return e.abrupt("return",{error:p});case 19:return!c.meta||"lineItems"in c.meta||(l=c.meta,c.meta.lineItems=[{label:"buy.quote.payment-method",valueSlug:"exchange.title.sepa"},{label:"buy.quote.delivery",valueText:"4-6 day"},{label:"buy.quote.subtotal",value:l.subtotal},{label:"buy.quote.fee",value:l.fee},{label:"buy.quote.total",value:l.from}]),e.abrupt("return",{result:c});case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),tradeStatus:function(){var e=i()(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u.a.rpc("coinify/trade_status",{serviceToken:this.token,tradeId:Number(t)}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),execute:function(){var e=i()(regeneratorRuntime.mark(function e(t){var r,n,s,i,c,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.execute,console.log("EXECUTE: ",r),e.next=4,this.prepareExecutionHash(r.params,r.schema);case 4:return n=e.sent,console.log("RES: ",n),e.next=8,u.a.rpc("coinify/execute",a()({},n,{serviceToken:this.token}));case 8:if(s=e.sent,i=s.result,!(c=s.error)){e.next=13;break}return e.abrupt("return",{error:c});case 13:if("browser-url"!=(l=i.action||i).type){e.next=19;break}return e.next=17,Object(o.a)(l);case 17:e.next=20;break;case 19:throw new Error("Unknown result type: ",l.type||l);case 20:return this.$store.dispatch("exchange/updateMeta",{"services.coinify.lastTxId":i.transaction.id}),e.next=23,this.tradeStatus(i.transaction.id);case 23:if(f=e.sent,"awaiting_transfer_in"!=Object(p.g)(f,"result.transaction.state")||"credit"!=Object(p.g)(f,"result.transaction.style")){e.next=26;break}return e.abrupt("return",{result:{meta:{screen:{screenType:"error",title:"Order Incomplete",message:"Don’t worry, it happens sometimes. Double check your credit card info and try again.",userActions:[l]}}}});case 26:if(!f.error){e.next=28;break}return e.abrupt("return",{result:i});case 28:return e.abrupt("return",{result:a()({},f.result,{delivery:i.delivery,detailsUrl:i.detailsUrl})});case 29:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}}}}]);
//# sourceMappingURL=9b7b23f09d90e4bae8f1.js.map